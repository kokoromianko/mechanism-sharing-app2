# メカニズム共有プラットフォーム 変更履歴

このファイルには、プロジェクトの重要な変更点を記録します。

## [未リリース]

### 追加
- 統合テスト実装（2025-05-02）
  - 統合テスト用の設定ファイル（conftest.py）の実装
  - 認証機能の統合テスト実装
    - ユーザー登録からログインまでのフロー検証
    - 無効な認証情報でのログイン失敗検証
    - 認証が必要なエンドポイントへのアクセス検証
  - メカニズム機能の統合テスト実装
    - メカニズム一覧取得の検証
    - メカニズム詳細取得の検証
    - メカニズム作成の検証
    - 認証なしでのメカニズム操作の検証
    - 無効なデータでのメカニズム作成の検証
  - カテゴリー機能の統合テスト実装
    - カテゴリー一覧取得の検証
    - カテゴリー詳細取得の検証
    - カテゴリー作成・更新・削除の検証
    - 認証なしでのカテゴリー操作の検証
  - いいね機能の統合テスト実装
    - いいね追加・取り消しの検証
    - いいね数取得の検証
    - ユーザーがいいねしたメカニズム一覧取得の検証
    - 人気のメカニズム取得の検証
  - フロントエンドとバックエンドの連携テスト実装
    - 認証フローの検証
    - メカニズム操作フローの検証
    - カテゴリー操作フローの検証
    - エラーハンドリングの検証
    - ファイルアップロード機能の検証
  - 統合テスト実行スクリプトの作成
- ドキュメント整備
  - プロジェクト設計図の作成（2025-04-29）
    - データベース設計図（ER図）の作成
    - フロントエンドアーキテクチャ図の作成
    - バックエンドアーキテクチャ図の作成
- バックエンド機能実装
  - データベース設定の実装（2025-04-29）
    - alembicを使用したマイグレーション設定
    - テストデータベース設定
    - データベース設定のテストコード実装
  - カテゴリー管理API実装（2025-04-29）
    - カテゴリーサービスの実装
    - カテゴリーAPIエンドポイントの実装
    - カテゴリーAPIのテストコード実装
  - いいね機能API実装（2025-04-29）
    - いいねサービスの実装
    - いいねAPIエンドポイントの実装
    - いいねAPIのテストコード実装
  - 認証機能実装（2025-04-29）
    - ユーザー登録API実装
    - ログインAPI実装
    - JWT認証ミドルウェア実装
    - パスワードハッシュ化機能実装
    - 認証機能のテストコード実装
  - 認証機能エンドポイントテスト実装（2025-04-29）
    - ユーザー登録エンドポイントのテスト
    - 既存メールアドレスでの登録エラーテスト
    - ログインエンドポイントのテスト
    - 無効な認証情報でのログインエラーテスト
    - 存在しないユーザーでのログインエラーテスト
  - メカニズム管理API実装（2025-04-29）
    - メカニズム一覧取得API実装
    - メカニズム詳細取得API実装
    - メカニズム投稿API実装（ファイルアップロード含む）
    - メカニズムサービスの実装
    - メカニズムAPIのテストコード実装
- フロントエンド機能実装
  - 信頼性レベルを数値から文字列に変換する機能を実装（2025-04-29）
    - 「妄想モデル」「実験により一部支持」「社内複数人が支持」「顧客含めて定番認識化」「教科書に記載」の5段階
    - 信頼性レベルに応じた背景色とテキスト色の設定
  - メカニズム詳細画面で信頼性レベルを文字列表示するよう改善（2025-04-29）
  - メカニズム一覧画面機能実装（2025-05-02）
    - メカニズム関連の型定義の実装
    - メカニズム関連のAPIサービスの実装
    - メカニズム一覧画面コンポーネントの実装（APIからデータ取得、ページネーション対応）
    - 信頼性レベルの文字列表示
    - メカニズム一覧画面のテストコード実装
  - メカニズム詳細画面機能実装（2025-05-02）
    - メカニズム詳細画面コンポーネントの実装（APIからデータ取得）
    - いいね機能の実装（認証状態に応じた処理）
    - ファイル表示機能の実装
    - メカニズム詳細画面のテストコード実装
  - メカニズム投稿画面機能実装（2025-05-02）
    - メカニズム投稿フォームの実装
    - フォームバリデーション機能の実装
    - ファイルアップロード機能の実装
    - サムネイルアップロード機能の実装
    - API連携機能の実装
    - メカニズム投稿画面のテストコード実装
  - APIとの連携実装（2025-05-02）
    - mechanismService.tsのテスト実装
      - メカニズム一覧取得機能のテスト
      - メカニズム詳細取得機能のテスト
      - メカニズム作成機能のテスト
      - いいね機能のテスト
      - いいね取り消し機能のテスト
    - api.tsのテスト実装
      - ローカルストレージ操作のテスト
      - リダイレクト機能のテスト
      - インターセプターのテスト実装（2025-05-02）
        - リクエストインターセプターのテスト
          - トークンがある場合のリクエストヘッダー検証
          - トークンがない場合のリクエストヘッダー検証
        - レスポンスインターセプターのテスト
          - 正常なレスポンスの処理検証
          - 401エラー時のログアウト処理検証
          - その他のエラー時の処理検証
  - 認証画面機能実装（2025-04-29）
    - 認証関連の型定義の実装
    - 認証関連のAPIサービスの実装
    - 認証コンテキストの実装
    - ログインフォームコンポーネントの実装
    - 登録フォームコンポーネントの実装
    - 保護されたルートコンポーネントの実装
    - ナビゲーションバーの実装（ログイン/ログアウト機能含む）
    - レイアウトコンポーネントの実装
    - 認証機能のテストコード実装（2025-04-29）
      - ログインフォームのテスト
      - 登録フォームのテスト
      - 保護されたルートのテスト
      - 認証コンテキストのテスト
      - 認証サービスのテスト
  - 共通コンポーネント実装（2025-04-29）
    - Button コンポーネントの実装とテスト
    - Input コンポーネントの実装とテスト
    - TextArea コンポーネントの実装とテスト
    - Select コンポーネントの実装とテスト
    - FileUpload コンポーネントの実装とテスト
    - Pagination コンポーネントの実装とテスト
    - Loading コンポーネントの実装とテスト
    - Header コンポーネントの実装とテスト
    - Footer コンポーネントの実装とテスト
- プロジェクトの基本構造を整備
- バックエンド（FastAPI）の基本設定
  - データベースモデル（User, Mechanism, Category, Like）の定義
  - Pydanticスキーマの定義
  - 設定ファイル（config.py）の作成
  - データベース接続設定（database.py）の作成
  - メインアプリケーション（main.py）の骨組み実装
- フロントエンド（React + TypeScript）の基本設定
  - プロジェクト構造の整備
  - ルーティング設定
  - 基本的なページコンポーネントの骨組み実装
    - ログインページ
    - 新規登録ページ
    - メカニズム一覧ページ
    - メカニズム詳細ページ
    - メカニズム投稿ページ
  - Tailwind CSSの導入
- ドキュメント整備
  - 要件定義書の作成
  - 詳細設計書の作成
  - MVP開発計画の作成
  - 開発コンテキスト文書の作成（2025-04-27）
  - 変更履歴の作成（2025-04-27）

### 変更
- READMEのデータベースセットアップ手順を改善（2025-05-07）
  - PostgreSQLデータベース作成後のマイグレーション実行手順を追加
  - マイグレーションの状態確認方法とマイグレーション履歴確認方法を追加

### 修正
- メカニズム詳細画面に「ダウンロード」ボタンを追加(2025-05-10)
  - 「ファイルを表示」ボタンの隣にダウンロードボタンを配置
  - ユーザーがファイルを直接ダウンロードできるようにして利便性を向上
- メカニズム一覧でタイルをクリックして詳細画面に遷移できるよう修正(2025-05-10)
  - タイル全体をクリック可能にして、ユーザビリティを向上
  - context.md参照
- ブラウザでサムネイルが表示されていなかったものを修正(2025-05-10)
  - context.md参照
- 統合テストでのファイルパス処理の修正（2025-05-06）
  - 問題：PNGファイルのアップロードと表示のテストが失敗する
  - 原因：テストコードでファイルパスの扱いが不適切で、`client.get(f"/{file_path}")`としていたが、`file_path`には既に`uploads/files/uuid.png`のようなパスが含まれていた
  - 修正内容：
    - `tests/integration/test_mechanism_integration.py`の`test_upload_and_display_png_file`テストを修正
    - ファイルパスを`/uploads/files/{os.path.basename(file_path)}`の形式に変更
    - サムネイルパスも同様に修正
  - 結果：PNGファイルのアップロードと表示のテストが正常に実行されるようになった

- ファイルとサムネイル画像のURL構築処理の修正（2025-05-04）
  - 問題：メカニズム詳細画面から「ファイルを表示」しても画像が表示されない、メカニズム一覧画面でサムネイル画像が表示されない
  - 原因：フロントエンドでファイルパスをそのまま使用していたため、正しいURLが構築されていなかった
  - 修正内容：
    - `frontend/src/utils/fileUtils.ts`を新規作成し、ファイルパスをフルURLに変換する`getFileUrl`関数を実装
    - `frontend/src/pages/MechanismDetailPage.tsx`を修正し、ファイルパスを`getFileUrl`関数で処理するよう変更
    - `frontend/src/pages/MechanismListPage.tsx`を修正し、サムネイルパスを`getFileUrl`関数で処理するよう変更
  - 結果：アップロードされたファイルとサムネイル画像が正しく表示されるようになった

- メカニズム詳細画面のファイル表示機能の修正（2025-05-04）
  - 問題：メカニズム投稿できるが、詳細画面から「ファイルを表示」しても画像が表示されない
  - 原因：アップロードされたファイルが静的ファイルとして公開されていなかった
  - 修正内容：
    - `backend/app/main.py`に`StaticFiles`ミドルウェアを追加して、`uploads`ディレクトリを静的ファイルとして公開
    - `frontend/src/pages/MechanismDetailPage.tsx`のファイル表示部分を改善して、画像ファイルの場合はプレビューを表示するよう修正
  - 結果：アップロードされたpngファイルがメカニズム詳細画面で正しく表示されるようになった
- メカニズムAPIエンドポイントの修正（2025-05-04）
  - フロントエンドからのリクエストが`/mechanisms`に送信されていたが、バックエンドのエンドポイントは`/api/mechanisms`
  - `mechanismService.ts`のリクエスト先を`/mechanisms`から`/api/mechanisms`に修正
  - `mechanismService.ts`のリクエスト先を`/likes`から`/api/likes`に修正
- 認証APIエンドポイントの修正（2025-05-03）
  - フロントエンドとAPIクライアントのリクエスト先を`/register`から`/api/auth/register`に修正
  - フロントエンドとAPIクライアントのリクエスト先を`/login`から`/api/auth/login`に修正
  - 関連するテストコードも修正
- 統合テストの修正（2025-05-03）
  - カテゴリー削除エンドポイントのステータスコードを204から200に変更
  - いいね機能のエンドポイントを修正（`/{mechanism_id}`から`/`に変更）
  - いいね機能のレスポンスに`user_id`フィールドを追加
  - いいね機能でメカニズムの存在チェックを追加
  - テストコードの期待値を実装に合わせて修正
- メカニズム一覧画面のテスト修正（2025-05-02）
  - Loadingコンポーネントにrole="status"属性を追加
  - テストでデータ読み込み完了を適切に待機するよう修正
  - ページネーションのテストでaria-labelを正確に指定するよう修正
  - App.test.tsxのテストを修正（より具体的なセレクタを使用）
- メカニズム投稿画面のテスト修正（2025-05-02）
  - reliability値の型を文字列から数値に修正（実装と一致するよう）
  - キャンセルボタンの特定方法を改善（複数のボタンが存在する場合の対応）

### 削除
- なし

## [0.0.1] - 2025-04-27
### 追加
- プロジェクト初期設定
- .gitignoreファイルの作成
- READMEの作成
