# メカニズム共有プラットフォーム 開発コンテキスト

## 要約

メカニズム共有プラットフォームは、物理的なメカニズムを可視化して共有し、ユーザー間でインタラクションを行うためのWebアプリケーションです。現在はMVP（Minimum Viable Product）開発フェーズにあり、基本的なプロジェクト構造とデータモデルが整備されています。バックエンドはPython + FastAPI、フロントエンドはReact + TypeScript + Tailwind CSSで実装されています。現在は、APIエンドポイントの実装とフロントエンドの機能実装を進める段階にあります。プロジェクトの設計図（ER図、クラス図、アーキテクチャ図）が作成され、開発の指針となっています。

## 1. プロジェクト概要

### 1.1 目的
物理的なメカニズムを可視化して共有し、ユーザー間でインタラクションを行うプラットフォームを提供することを目的としています。ユーザーはメカニズムを投稿・閲覧・評価することができます。

### 1.2 主要機能
- ユーザー管理機能（登録・認証）
- メカニズム投稿・表示機能
- カテゴリー管理機能
- いいね機能
- 信頼性レベル管理

## 2. 現在の開発状況

### 2.1 全体進捗
プロジェクトは現在、MVPの開発段階にあります。基本的なプロジェクト構造が整備され、データモデルやスキーマの定義が完了しています。APIエンドポイントの実装とフロントエンドの機能実装はこれから進める予定です。

### 2.2 バックエンド（Python + FastAPI）
- 基本的なプロジェクト構造が整備されています
- データベースモデル（User, Mechanism, Category, Like）が定義されています
- Pydanticスキーマが定義されています
- メインアプリケーションの骨組みが実装されています
- 実際のAPIエンドポイント実装はまだ行われていません
- 仮想環境はルートディレクトリ以下に.venvフォルダとして置かれています

### 2.3 フロントエンド（React + TypeScript + Tailwind CSS）
- プロジェクト構造が整備されています
- 基本的なページコンポーネントの骨組みが実装されています
- ルーティングが設定されています
- スタイリングにTailwind CSSが導入されています
- APIとの連携はまだ実装されていません

## 3. 実装済みの機能

### 3.1 バックエンド
- プロジェクト構造の整備
- データベースモデルの定義
  - User（ユーザー）モデル
  - Mechanism（メカニズム）モデル
  - Category（カテゴリー）モデル
  - Like（いいね）モデル
- Pydanticスキーマの定義
- 基本的な設定（config.py）
- データベース接続設定（database.py）
- メインアプリケーションの骨組み（main.py）

### 3.2 フロントエンド
- プロジェクト構造の整備
- ルーティング設定
- 基本的なページコンポーネントの骨組み
  - ログインページ
  - 新規登録ページ
  - メカニズム一覧ページ
  - メカニズム詳細ページ
  - メカニズム投稿ページ
- Tailwind CSSの導入

## 4. 実装予定の機能（MVP対象）

### 4.1 バックエンド
- データベース設定（PostgreSQL）
- 認証機能実装
  - ユーザー登録API
  - ログインAPI
  - JWT認証ミドルウェア
- メカニズム管理API実装
  - メカニズム一覧取得API
  - メカニズム詳細取得API
  - メカニズム投稿API（ファイルアップロード含む）
- カテゴリー管理API実装
- いいね機能API実装

### 4.2 フロントエンド
- 認証画面機能実装
- 共通コンポーネント実装
- メカニズム一覧画面機能実装
- メカニズム詳細画面機能実装
- メカニズム投稿画面機能実装
- APIとの連携実装

## 5. 課題と対応状況

### 5.1 現在の課題
1. 新規投稿画面でカテゴリ入力を別の画面からボタンクリックで入力できるようにしたい（テスト必要）

### 5.2 完了した課題
1. プロジェクトの設計図（ER図、クラス図、アーキテクチャ図）の作成（2025-04-29完了）
   - データベース設計図（ER図）を作成
   - フロントエンドアーキテクチャ図を作成
   - バックエンドアーキテクチャ図を作成
1. メカニズム詳細画面で信頼性のレベルが数字表記だが、「妄想モデル」など信頼性定義文章を表示するようにしたい（2025-04-29完了）
   - 信頼性レベルを数値から文字列に変換する関数 `getReliabilityLabel` を実装
   - 信頼性レベルに応じた背景色とテキスト色のクラス名を返す関数 `getReliabilityColorClass` を実装
   - メカニズム詳細画面で上記関数を使用して信頼性レベルを文字列表示
2. データベース設定の実装（2025-04-29完了）
   - alembicを使用したマイグレーション設定を実装
   - テストデータベース設定を実装
   - データベース設定のテストコードを実装
   - PostgreSQLデータベースの作成とテーブル作成
3. カテゴリー管理API実装（2025-04-29完了）
   - カテゴリーサービスクラスの実装
     - カテゴリー一覧取得機能
     - カテゴリー詳細取得機能
     - カテゴリー作成機能
     - カテゴリー更新機能
     - カテゴリー削除機能
   - カテゴリーAPIエンドポイントの実装
     - GET /api/categories/ - カテゴリー一覧取得
     - GET /api/categories/{category_id} - カテゴリー詳細取得
     - POST /api/categories/ - カテゴリー作成
     - PUT /api/categories/{category_id} - カテゴリー更新
     - DELETE /api/categories/{category_id} - カテゴリー削除
   - カテゴリーサービスのユニットテスト実装
4. いいね機能API実装（2025-04-29完了）
   - いいねサービスクラスの実装
     - いいね取得機能
     - いいね作成機能
     - いいね削除機能
     - メカニズムのいいね数取得機能
     - ユーザーがいいねしたメカニズム一覧取得機能
     - 人気のメカニズム取得機能
   - いいねAPIエンドポイントの実装
     - POST /api/likes/{mechanism_id} - いいね作成
     - DELETE /api/likes/{mechanism_id} - いいね削除
     - GET /api/likes/mechanism/{mechanism_id} - メカニズムのいいね数取得
     - GET /api/likes/popular - 人気のメカニズム取得
     - GET /api/likes/user/{user_id}/liked - ユーザーがいいねしたメカニズム一覧取得
   - いいねサービスのユニットテスト実装
5. 認証機能実装（2025-04-29完了）
   - セキュリティユーティリティの実装
     - パスワードハッシュ化機能
     - JWTトークン生成・検証機能
   - 認証サービスの実装
     - ユーザー登録機能
     - ユーザー認証機能
     - ログイン機能
   - 認証ミドルウェアの実装
     - JWTトークン検証
     - 現在のユーザー取得
   - 認証APIエンドポイントの実装
     - POST /api/auth/register - ユーザー登録
     - POST /api/auth/login - ログイン
   - 認証機能のユニットテスト実装
6. メカニズム管理API実装（2025-04-29完了）
   - メカニズムサービスクラスの実装
     - メカニズム一覧取得機能
     - メカニズム詳細取得機能
     - いいね数取得機能
     - ファイルアップロード機能
     - カテゴリー取得・作成機能
     - メカニズム作成機能
   - メカニズムAPIエンドポイントの実装
     - GET /api/mechanisms/ - メカニズム一覧取得
     - GET /api/mechanisms/{mechanism_id} - メカニズム詳細取得
     - POST /api/mechanisms/ - メカニズム投稿
   - メカニズムサービスのユニットテスト実装
   - アップロードディレクトリの作成
     - uploads/files - メカニズムファイル保存用
     - uploads/thumbnails - サムネイル画像保存用

## 6. 技術スタック

### 6.1 フロントエンド
- React 19
- TypeScript
- Tailwind CSS
- React Router
- React Query
- Axios

### 6.2 バックエンド
- Python 3.10+
- FastAPI
- SQLAlchemy
- Pydantic
- JWT認証
- Bcrypt（パスワードハッシュ化）

### 6.3 データベース
- PostgreSQL

### 6.4 開発ツール
- Git（バージョン管理）
- VSCode（コードエディタ）

## 7. プロジェクト構造

### 7.1 バックエンド構造
```
backend/
├── app/
│   ├── main.py              # メインアプリケーション
│   ├── config.py            # 設定ファイル
│   ├── database.py          # データベース接続
│   ├── models/              # データベースモデル
│   │   ├── user.py          # ユーザーモデル
│   │   ├── mechanism.py     # メカニズムモデル
│   │   ├── category.py      # カテゴリーモデル
│   │   └── like.py          # いいねモデル
│   ├── schemas/             # Pydanticスキーマ
│   │   ├── user.py          # ユーザースキーマ
│   │   ├── mechanism.py     # メカニズムスキーマ
│   │   ├── category.py      # カテゴリースキーマ
│   │   └── like.py          # いいねスキーマ
│   ├── routers/             # APIルーター（未実装）
│   ├── services/            # ビジネスロジック（未実装）
│   ├── middlewares/         # ミドルウェア（未実装）
│   └── utils/               # ユーティリティ（未実装）
└── requirements.txt         # 依存関係
```

### 7.2 フロントエンド構造
```
frontend/
├── public/                  # 静的ファイル
├── src/
│   ├── App.tsx              # メインアプリケーション
│   ├── index.tsx            # エントリーポイント
│   ├── components/          # コンポーネント
│   │   ├── auth/            # 認証関連コンポーネント
│   │   ├── common/          # 共通コンポーネント
│   │   ├── layout/          # レイアウトコンポーネント
│   │   └── mechanism/       # メカニズム関連コンポーネント
│   ├── pages/               # ページコンポーネント
│   │   ├── LoginPage.tsx    # ログインページ
│   │   ├── RegisterPage.tsx # 新規登録ページ
│   │   ├── MechanismListPage.tsx    # メカニズム一覧ページ
│   │   ├── MechanismDetailPage.tsx  # メカニズム詳細ページ
│   │   └── MechanismNewPage.tsx     # メカニズム投稿ページ
│   ├── services/            # APIサービス（未実装）
│   ├── hooks/               # カスタムフック（未実装）
│   ├── contexts/            # コンテキスト（未実装）
│   ├── types/               # 型定義（未実装）
│   └── utils/               # ユーティリティ（未実装）
├── package.json             # 依存関係
└── tsconfig.json            # TypeScript設定
```

## 8. 今後の開発計画

### 8.1 設計ドキュメント
プロジェクトの設計図は以下のファイルに保存されています：
- `docs/database_diagram.md`: データベース設計図（ER図）
- `docs/frontend_architecture.md`: フロントエンドアーキテクチャ図
- `docs/backend_architecture.md`: バックエンドアーキテクチャ図

これらの設計図は、開発の進行に合わせて適宜更新されます。

### 8.2 MVPリリースまでのマイルストーン
1. バックエンド基盤完成（2週間）
   - データベース設計・実装完了
   - 認証APIの実装完了
   - メカニズム管理APIの実装完了
   - いいね機能APIの実装完了

2. フロントエンド基本機能完成（3週間）
   - 認証画面の実装完了
   - メカニズム一覧・詳細画面の実装完了
   - メカニズム投稿機能の実装完了
   - APIとの連携完了

3. 統合・テスト（1週間）
   - 統合テスト完了
   - バグ修正完了

### 8.3 MVPリリース後の拡張計画
1. ソート・フィルター機能
2. コメント機能
3. 統計情報管理（閲覧数、時系列データ可視化）
4. ダウンロード・シェア機能
5. プロフィール管理機能の拡充
